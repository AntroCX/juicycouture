var selectedSKU;function setSKU(){if("Y"==preorder){0==$(".b-catalog-detail__sizes-list-item.active").length&&$(".b-catalog-detail__sizes-list-item").first().addClass("active"),$(".b-catalog-detail__add2basket").addClass("hidden"),$(".b-catalog-detail__reservation-all").addClass("hidden");var t=sku_tree,e=$(".b-catalog-detail__sizes-list-item.active").attr("data-id"),a=t[Object.keys(t)[0]][e];return $(".b-catalog-detail__sizes-select").html(a.SIZE),$(".b-modal-reserved__product-size").html(a.SIZE),$(".b-catalog-detail__colors-select").html(a.COLOR),$(".b-catalog-detail__artnum-data").html(a.ARTNUMBER),$(".sku-id").val(a.ARTNUMBER),$(".b-modal-reserved__product-price").find(".price-base").html(a.PRICE),a.DISCOUNT_PRICE?($(".b-catalog-detail__price").find(".price-sale_no").attr("class","price-sale"),$(".b-catalog-detail__price").find(".price-sale").html(a.DISCOUNT_PRICE),$(".b-modal-reserved__product-price").find(".price-sale_no").attr("class","price-sale"),$(".b-modal-reserved__product-price").find(".price-sale").html(a.DISCOUNT_PRICE)):($(".b-catalog-detail__price").find(".price-sale").attr("class","price-sale_no"),$(".b-modal-reserved__product-price").find(".price-sale").attr("class","price-sale_no"),$(".b-modal-reserved__product-price").find(".price-base").html(a.PRICE)),!1}var i,d,l,s,t=sku_tree,e=$(".b-catalog-detail__sizes-list-item.active").attr("data-id"),o=$(".b-catalog-detail__sizes .b-catalog-detail__sizes-list-item"),c=$(".b-catalog-detail__colors-list-item"),n=[],r=$(".b-catalog-detail__colors-list-item.active").attr("data-id"),_=$(".b-shops");"Y"==hide_retail&&$(".b-shops").addClass("hide-btn"),void 0===r&&((s=$(".b-catalog-detail__colors-list-item :first-child")).addClass("active"),r=s.attr("data-id")),$.each(t[r],function(t,a){"N"!=a.DENIED_DELIVERY&&"N"!=a.DENIED_RESERVATION||n.push(t),d||"N"!=a.DENIED_DELIVERY||(d=t),l||"N"!=a.DENIED_RESERVATION||(l=t),i=i||t,"Y"==a.DENIED_DELIVERY&&$('.b-catalog-detail__sizes-list-item[data-id="'+t+'"]').addClass("not-buy"),"Y"==a.DENIED_RESERVATION&&$('.b-catalog-detail__sizes-list-item[data-id="'+t+'"]').addClass("not-rezerv")}),e=e||d||l||i,$('.b-catalog-detail__sizes-list-item[data-id="'+e+'"]').addClass("active"),$(".b-modal-reserved__product-size").text($('.b-catalog-detail__sizes-list-item[data-id="'+e+'"]').text());a=t[r][e];selectedSKU=a,$(".sku-id").val(selectedSKU.ID),_.length&&_.toggle("N"===selectedSKU.DENIED_RESERVATION),o.each(function(){var t=$(this),a=t.attr("data-id");-1==$.inArray(a,n)?t.addClass("notavailable"):t.removeClass("notavailable")}),$(".b-catalog-detail__sizes-select").html(a.SIZE),$(".b-catalog-detail__colors-select").html(a.COLOR),$(".b-catalog-detail__artnum-data").html(a.ARTNUMBER),loadRetailShops(a.ARTNUMBER,a.DENIED_RESERVATION),a.DISCOUNT_PRICE?($(".b-catalog-detail__price").find(".price-sale_no").attr("class","price-sale"),$(".b-catalog-detail__price").find(".price-sale").html(a.DISCOUNT_PRICE),$(".b-modal-reserved__product-price").find(".price-sale_no").attr("class","price-sale"),$(".b-modal-reserved__product-price").find(".price-sale").html(a.DISCOUNT_PRICE)):($(".b-catalog-detail__price").find(".price-sale").attr("class","price-sale_no"),$(".b-modal-reserved__product-price").find(".price-sale").attr("class","price-sale_no")),$(".b-catalog-detail__price").find(".price-base").html(a.PRICE),$(".b-modal-reserved__product-price").find(".price-base").html(a.PRICE),$("#offerId").val(a.ID);var p=$(".b-catalog-detail__count-selector");p.find("option").remove();_=$(".b-catalog-detail__add2basket"),$(".b-catalog-detail__empty");if(0<a.QUANTITY&&"Y"!==a.DENIED_DELIVERY){_.removeAttr("disabled");for(var m=1;m<=a.QUANTITY;m++){var b=$("<option></option>").attr("value",m).text(m);p.append(b)}}else{b=$("<option></option>").attr("value",1).text(1);p.append(b),_.attr("disabled","disabled")}o=$(".b-catalog-detail__photos-current[data-color="+a.COLOR_CODE+"]");o.addClass("active"),$(".b-catalog-detail__photos-current").not(o).removeClass("active"),c.each(function(){var t=$(this),a=parseInt(t.attr("data-id"));-1==$.inArray(a,color_available[e])?t.addClass("notavailable"):t.removeClass("notavailable")}),skuInCart[a.ID]?_.addClass("added"):_.removeClass("added");_=$(".b-catalog-detail__sizes-list-item").length!=$(".b-catalog-detail__sizes-list-item.notavailable").length;$(".b-catalog-detail__sizes-titles, .b-catalog-detail__add2basket, .b-catalog-detail__reservation-all").toggleClass("hidden",!_),$(".b-catalog-detail-no").toggleClass("hidden",_)}function initComplect(){if(!$(".complect-block").length)return!1;var t=$(".complect-block");return t.find(".slide-sizes").on("click",function(){return $(this).closest(".detail-sizes").toggleClass("opened"),!1}),t.find("input.add").on("change",function(){return $(this).closest(".complect-item-block").toggleClass("unselected",!$(this).prop("checked")),checkTotalComplectPrice(),!1}),t.find(".complect-item").each(function(){var l=$(this);l.find(".list-sizes").find('input[type="radio"]').change(function(){var t,a,e,i,d;$(this).prop("checked")&&(a=(t=$(this)).closest(".complect-item-block").data("id"),e=t.data("article"),i=t.data("pricebase"),d=t.data("price"),l.find("#"+a+"-article").html("<span>Артикул: </span>"+e),d<i?l.find("#"+a+"-price").html('<div class="price-sale">'+t.data("priceformat")+'</div><div class="price-base">'+t.data("pricebaseformat")+"</div>"):l.find("#"+a+"-price").html('<div class="price-base">'+t.data("priceformat")+"</div>"),checkTotalComplectPrice())}),l.find(".b-catalog-detail__sizes-list-item").first().click()}),t.find("#buyComplect").on("click",function(){var a=[];return t.find(".complect-item-block").each(function(){var t;$(this).find("input.add:checked").length&&(t=$(this).find(".detail-sizes").find("input:checked").val(),a.push(t))}),buyComplect(t,a),!1}),!0}function checkTotalComplectPrice(){var t=$(".complect-block"),a=0;t.find(".complect-item-block").each(function(){$(this).find("input.add:checked").length&&(a+=parseInt($(this).find(".detail-sizes").find("input:checked").data("price")))}),t.find(".complect-price span").first().html(a),t.find("#buyComplect").toggleClass("none",!a)}function buyComplect(t,a){t.find("#buyComplect").addClass("btn_load"),$.post("/local/ajax/update_small_cart.php",{action:"ADD2BASKETLIST",ajax_basket:"Y",ids:a},function(){void 0!==window.digitalData.events&&t.find(".complect-item-block").each(function(){var t,a=$(this).data("id");$(this).find("input.add:checked").length&&(t=$(this).find(".detail-sizes").find("input:checked").val(),window.digitalData.events.push({category:"Ecommerce",name:"Added Product",product:{id:a,skuCode:t},quantity:1}))}),BX.onCustomEvent("OnBasketChange"),t.find("#buyComplect").removeClass("btn_load")}).fail(function(t){console.log(t)})}$(function(){window.skuInCart={},setSKU(),initComplect();var t=$(".b-catalog-detail__description-more"),a=$("body"),e=$(".b-catalog-detail__description-detail");t.on("click",function(){$(this).hide(),e.fadeIn()});var i=".b-catalog-detail__sizes-list-item",d=$(i);a.on("click",i,function(){var t=$(this);t.addClass("active"),d.parent().find(i).not(t).removeClass("active"),setSKU()});var l=".b-catalog-detail__colors-list-item",s=$(l);a.on("click",l,function(){var t=$(this);t.addClass("active"),s.parent().find(l).not(t).removeClass("active"),setSKU()});a.find(".b-catalog-detail__photos-list").each(function(){var a=$(this);a.slick({infinite:!0,arrows:!1,speed:500,fade:!0,cssEase:"linear"}),a.parents(".b-catalog-detail__photos-current").find(".b-catalog-detail__photos-list-nav-item").on("click",function(){var t=$(this);a.slick("slickGoTo",t.index())})}),a.on("click",".b-catalog-detail__social-item",function(t){var a=$(this);t.preventDefault(),window.open(a.attr("href"),"_blank","height=400,width=400")}),a.on("click",".b-catalog-detail__add2basket",function(t){var o=$(this),c=$("#offerId").val(),a=$(".b-catalog-detail__count-selector").val();o.attr("data-url");void 0===a&&(a=1),t.preventDefault(),o.hasClass("added")||o.hasClass("btn_load")||(o.addClass("btn_load"),o.attr("disabled","disabled"),$.get("/local/ajax/update_small_cart.php",{action:"ADD2BASKET",quantity:a,id:c,ajax_basket:"Y"}).done(function(){$(".b-fast-cart");if(void 0!==window.digitalData.events&&void 0!==selectedSKU){var t=null,a=o.data("product-id");if(void 0!==window.digitalData.product)window.digitalData.product.id==a&&(t=window.digitalData.product);else if(t||void 0===window.digitalData.listing){if(!t&&void 0!==window.digitalData.recommendation)for(i=0;i<window.digitalData.recommendation.length;i++)for(var e=0;e<window.digitalData.recommendation[i].items.length;e++)if(window.digitalData.recommendation[i].items[e].id==a){t=window.digitalData.recommendation[i].items[e];break}}else for(var i=0;i<window.digitalData.listing.items.length;i++)if(window.digitalData.listing.items[i].id==a){t=window.digitalData.listing.items[i];break}if(t){var d={event:"added"};if(d.product=t,void 0!==window.digitalData.events&&void 0!==selectedSKU&&"added"==d.event){var l,s=1;for(l in window.digitalData.cart.lineItems)d.product.id==window.digitalData.cart.lineItems[l]&&(s=window.digitalData.cart.lineItems[l].quantity+1);d.product.skuCode=c,window.digitalData.events.push({category:"Ecommerce",name:"Added Product",product:{id:d.product.id,skuCode:d.product.skuCode},quantity:+s})}}}window.cartId.action="add",BX.onCustomEvent("OnBasketChange"),o.removeClass("btn_load"),o.addClass("added"),o.removeAttr("disabled"),skuInCart[selectedSKU.ID]=!0}))}),a.on("click",".b-catalog-detail__add2basket.added",function(){location.href="/order/"}),a.on("click",".b-catalog-detail__count-to-shops",function(t){scrollToAnchor("stores")}),a.on("click",".js-discount-tip",function(){$(this).closest(".b-catalog-detail__price-discount-tip").find(".b-catalog-detail__price-discount-tip-text").toggleClass("showed")}),$("#modalSizeChart tr td:not([rowspan])").on({mouseenter:function(){var t=$(this),a=t.closest("tbody"),e=t.closest("tr"),i=t.index(),d=0;0<e.find("td").attr("rowspan")?d=i-1:(d=i,i+=1),a.find("tr").each(function(){(0<$(this).find("td").attr("rowspan")?$(this).find("td").eq(i):$(this).find("td").eq(d)).addClass("light-bg")}),e.addClass("light-tr"),t.addClass("dark-bg")},mouseleave:function(){var t=$(this),a=t.closest("tbody"),e=t.closest("tr");t.removeClass("dark-bg"),e.removeClass("light-tr"),a.find("td.light-bg").removeClass("light-bg")}});var o=$(".reservationForm");return o.validate({rules:{email:{email:!0,mailFormat:!0}},submitHandler:function(){return BX.showWait(),$.post("/local/ajax/subscribeProduct.php",o.serialize()).done(function(t){$("#product_subscriptionModal").find(".modal-body").html(t),BX.closeWait()}),!1}}),!1});
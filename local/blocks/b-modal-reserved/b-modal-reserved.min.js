function mapReservedInit(a){ymaps.ready(function(){$("#YMapsID");var t=[],o=new ymaps.Map("YMapsID",{controls:[],center:[a[0],a[1]],zoom:14},{searchControlProvider:!1});o.controls.add(new ymaps.control.ZoomControl);var e=new ymaps.Placemark([a[0],a[1]],{},{iconLayout:"default#image",iconImageHref:"/local/images/mapmarker@x2.png",iconImageSize:[42,42],iconImageOffset:[0,-42]});$("body").on("change",".b-reservation-shop-select",function(){o.geoObjects.removeAll();var e=$(this).find("option:selected").attr("data-coords").split(","),a=new ymaps.Placemark([e[0],e[1]],{},{iconLayout:"default#image",iconImageHref:"/local/images/mapmarker@x2.png",iconImageSize:[42,42],iconImageOffset:[0,-42]});t.push(a),o.geoObjects.add(a),o.setCenter([e[0],e[1]],18,{checkZoomRange:!0})}),t.push(e),o.geoObjects.add(e)})}$(function(){var e=$("body"),o={id:"",address:"",coords:"",type:""},i=$("#reservedInStore");$("input[name=RESERVED_PHONE]").mask("+7(999)999-99-99");var a=$(".b-modal-reserved__form");function t(){mapReservedInit(o.coords),$(".b-modal-reserved__shop-address").html(o.address),$(".b-modal-reserved__product-artnum").html(selectedSKU.ARTNUMBER),$(".b-modal-reserved__product-size").html(selectedSKU.SIZE),$(".b-modal-reserved__product-price").html(selectedSKU.PRICE);var e=$(".b-catalog-detail__photos-current.active").find(".b-catalog-detail__photos-list-nav-item:first-child").find("img").attr("src");$("#b-modal-reserved__preview").attr("src",e)}a.validate({rules:{RESERVED_NAME:{required:!0},RESERVED_PHONE:{required:!0,phoneFormat:!0},RESERVED_EMAIL:{required:!0}}}),i.on("show.bs.modal",function(){t()}),i.on("hide.bs.modal",function(){$("#YMapsID").empty()}),e.on("click",".btn-reserved",function(){var e=$(this);if(e.hasClass("b-catalog-detail__reservation-all"))$(".b-reservation-shop-list").removeClass("hidden"),$.post("/local/ajax/get_shops.php",{artnumber:selectedSKU.ARTNUMBER,skuId:selectedSKU.ID,sessid:$("#sessid").val(),template:"select"}).done(function(e){var a=$(".b-reservation-shop-select");a.html(e.html);var t=a.find("option:first-child");o={id:t.attr("data-id"),address:t.text(),coords:t.attr("data-coords").split(","),type:t.data("type")},i.modal("show"),void 0!==window.digitalData.events&&(window.digitalData.cart.checkoutType="reservation",window.digitalData.events.push({category:"Ecommerce",name:"Viewed Cart",cart:window.digitalData.cart}))});else if($(".b-reservation-shop-list").addClass("hidden"),o.id=e.attr("data-id"),o.coords=e.attr("data-coords").split(","),o.address=e.parents(".b-shops__list-item").find(".b-shops__list-item-address").text(),o.type=e.data("type"),i.modal("show"),void 0!==window.digitalData.events){window.digitalData.cart;var a={product:window.digitalData.product,quantity:1,subtotal:window.digitalData.product.unitSalePrice};window.digitalData.cart.checkoutType="reservation",window.digitalData.cart.lineItems=[],window.digitalData.cart.lineItems[0]=a,window.digitalData.cart.subtotal=a.product.unitSalePrice,window.digitalData.cart.total=a.product.unitPrice,window.digitalData.events.push({category:"Ecommerce",name:"Viewed Cart",cart:window.digitalData.cart})}}),e.on("change",".b-reservation-shop-select",function(){var e=$(this).find("option:selected");o={id:e.attr("data-id"),address:e.text(),coords:e.attr("data-coords"),type:e.data("type")},t()}),e.on("click",".btn-send-reservation",function(){a.valid()&&$.post("/local/ajax/reservation.php",{store_id:o.id,omni_type:o.type,product_id:selectedSKU.ID,sessid:$("#sessid").val(),name:$("input[name=RESERVED_NAME]").val(),email:$("input[name=RESERVED_EMAIL]").val(),phone:$("input[name=RESERVED_PHONE]").val(),tablet:$("select[name=RESERVED_TABLET]").val()}).done(function(e){var a=$("#b-modal-notify");a.find(".modal-body").html(e),i.modal("hide"),a.modal("show")})})});
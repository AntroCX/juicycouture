"use strict";function BitrixSmallCart(){}BitrixSmallCart.prototype={activate:function(){if(this.cartElement=BX(this.cartId),this.fixedPosition="Y"==this.arParams.POSITION_FIXED,this.isCurrentVisible=!0,this.action=null,this.fixedPosition){this.cartClosed=!0,this.maxHeight=!1,this.itemRemoved=!1,this.verticalPosition=this.arParams.POSITION_VERTICAL,this.horizontalPosition=this.arParams.POSITION_HORIZONTAL,this.topPanelElement=BX("bx-panel"),this.fixAfterRender(),this.fixAfterRenderClosure=this.closure("fixAfterRender");var t=this.closure("fixCart");this.fixCartClosure=t,this.topPanelElement&&"top"==this.verticalPosition&&BX.addCustomEvent(window,"onTopPanelCollapse",t);var e=null;BX.bind(window,"resize",function(){clearTimeout(e),e=setTimeout(t,200)})}this.setCartBodyClosure=this.closure("setCartBody"),BX.addCustomEvent(window,"OnBasketChange",this.closure("refreshCart",{})),this.addJqueryActions()},fixAfterRender:function(){this.statusElement=BX(this.cartId+"status"),this.statusElement&&(this.cartClosed?this.statusElement.innerHTML=this.openMessage:this.statusElement.innerHTML=this.closeMessage),this.productsElement=BX(this.cartId+"products"),this.fixCart()},closure:function(t,e){var i=this;return e?function(){i[t](e)}:function(e){i[t](e)}},closeCart:function(){$("body").find(".b-fast-cart").removeClass("b-fast-cart_show")},setVerticalCenter:function(t){var e=t/2-this.cartElement.offsetHeight/2;e<5&&(e=5),this.cartElement.style.top=e+"px"},fixCart:function(){if("hcenter"==this.horizontalPosition){var t=("innerWidth"in window?window.innerWidth:document.documentElement.offsetWidth)/2-this.cartElement.offsetWidth/2;t<5&&(t=5),this.cartElement.style.left=t+"px"}var e="innerHeight"in window?window.innerHeight:document.documentElement.offsetHeight;switch(this.verticalPosition){case"top":this.topPanelElement&&(this.cartElement.style.top=this.topPanelElement.offsetHeight+5+"px");break;case"vcenter":this.setVerticalCenter(e)}if(this.productsElement){var i=this.cartElement.querySelector("[data-role='basket-item-list']");this.cartClosed?this.maxHeight&&(BX.removeClass(this.cartElement,"bx-max-height"),i&&(i.style.top="auto"),this.maxHeight=!1):this.maxHeight?this.productsElement.scrollHeight==this.productsElement.clientHeight&&(BX.removeClass(this.cartElement,"bx-max-height"),i&&(i.style.top="auto"),this.maxHeight=!1):"top"==this.verticalPosition||"vcenter"==this.verticalPosition?this.cartElement.offsetTop+this.cartElement.offsetHeight>=e&&(BX.addClass(this.cartElement,"bx-max-height"),i&&(i.style.top="82px"),this.maxHeight=!0):this.cartElement.offsetHeight>=e&&(BX.addClass(this.cartElement,"bx-max-height"),i&&(i.style.top="82px"),this.maxHeight=!0),"vcenter"==this.verticalPosition&&this.setVerticalCenter(e)}},refreshCart:function(t){console.log("refreshCart"),t.sessid=BX.bitrix_sessid(),t.siteId=this.siteId,t.templateName=this.templateName,t.arParams=this.arParams,BX.ajax({url:this.ajaxPath,method:"POST",dataType:"html",data:t,onsuccess:this.setCartBodyClosure})},updateCart:function(t){$.ajax({type:"POST",data:{update_small:"Y"},url:"/local/ajax/update_small_cart.php",success:this.setCartBodyClosure})},setCartBody:function(t){this.cartElement&&(this.cartElement.innerHTML=t),this.fixedPosition&&setTimeout(this.fixAfterRenderClosure,100),this.initBasketFastbuy(!0),BX.closeWait(),"add"===this.action&&(this.action=null,$(".b-fast-cart__body-item").first().toggleClass("hl"),setTimeout(function(){$(".b-fast-cart__body-item").first().toggleClass("hl"),setTimeout(function(){$(".b-fast-cart").removeClass("b-fast-cart_show")},1e3)},1e3))},removeItemFromCart:function(t,e){if(this.closeCart(),BX.showWait(),this.refreshCart({sbblRemoveItemFromCart:t}),this.itemRemoved=!0,void 0!==window.digitalData.events&&void 0!==window.digitalData.cart){for(var i=null,a=0,s={},o=0;o<window.digitalData.cart.lineItems.length;o++)if(window.digitalData.cart.lineItems[o].product.skuCode==e){i=window.digitalData.cart.lineItems[o].product,a=window.digitalData.cart.lineItems[o].quantity;break}window.digitalData.events.push({category:"Ecommerce",name:"Removed Product",product:{id:i.id,skuCode:i.skuCode},quantity:a}),s.event="removed",s.product=i,this.updateCart(s)}},addJqueryActions:function(){var t=this;$("#"+this.cartId);$(function(){$(window).scroll(function(){var e=$(this),i=!1;if(e.width()<768)i=!0;else{e.scrollTop()<=140&&(i=!0)}t.isCurrentVisible=i}),$(document).mouseup(function(e){$(e.target).closest(".b-fast-cart").length||t.closeCart()}),t.initBasketFastbuy(!1)})},initBasketFastbuy:function(t){var e=this,i=$("#"+this.cartId),a=(i.find(".b-fast-cart"),i.find("ul.b-header__top-profile-menu").clone(!0));$("#basketBlockClone").html(a[0]),$(window).scroll(),$("body").on("click",".b-header__top-profile-menu-cart-ico",function(t){if($(this).hasClass("not-empty-basket")){var e=$(this).parent(".b-header__top-profile-menu-cart").find(".b-fast-cart");$(window).width()<768?e&&e.addClass("b-fast-cart_show"):location.href=$(this).attr("data-pathToBasket")}}),$("body").on("click",'a[data-target="#basket-fastbuy"]',function(){void 0!==window.digitalData.events&&(window.digitalData.cart.checkoutType="1-step-cart",window.digitalData.events.push({category:"Ecommerce",name:"Viewed Cart",cart:window.digitalData.cart}))});var s=$("body").find("#basket-fastbuy");if(!(s.length<=0)){var o=$(".b-fast-cart"),n=s.find(".js-basket-fast-buy-form"),r=s.find(".popup-swiper-container"),l=r.find(".basket-small-item.slick-slide").length,d=!1,c=navigator.userAgent.toLowerCase().indexOf("android")>-1?"+79999999999":"+7 (999) 999-99-99";s.on("click",".js-popup-close, .js-continue-shopping",function(){s.modal("hide"),BX.onCustomEvent(window,"OnBasketChange")}),n.find('[name="phone"]').mask(c),n.on("click",".js-coupon-toggle",function(){n.find(".js-coupon-form").toggleClass("none")}),n.on("click",".js-coupon-apply",function(){var t=n.find(".js-coupon-value").val();t.trim()&&$.post("/local/ajax/buy_one_click_basket.php",{coupon:t,sessid:n.find("#sessid").val(),type:"applyCoupon"},null,"json").done(function(t){t.success?(n.find(".js-discount").text("-"+t.data.discountSum),n.find(".js-order-total").text(parseInt(t.data.totalDiscountSum)+parseInt(n.find(".js-delivery-cost").text()))):(n.find(".js-coupon-error").show().html(t.errors),setTimeout(function(){n.find(".js-coupon-error").hide()},2e3))})}),n.validate({rules:{policyAccept:{required:!0},fio:{required:!0},phone:{required:!0,phoneFormat:!0},email:{required:!0,email:!0,mailFormat:!0}},errorClass:"error-notify",errorPlacement:function(t,e){$(e).filter(":not(.valid)").addClass("invalid")},submitHandler:function(t){BX.showWait();$(t).find(".invalid").removeClass("invalid"),s.addClass("load"),$.ajax({url:"/local/ajax/buy_one_click_basket.php",data:$(t).serialize(),dataType:"json",type:"POST",success:function(t){if(t.success){var e=s.find(".js-basket-fast-buy-success");if(s.find(".js-basket-fast-buy-content").hide(),s.find(".modal-header h4, .modal-header span").hide(),e.find(".js-order-number").text(t.orderId),e.show(),s.data("update",!0),window.inBasket=[],$("#buyBtn").addClass("active").html("<span>РґРѕР±Р°РІРёС‚СЊ РІ РєРѕСЂР·РёРЅСѓ</span>"),void 0!==window.digitalData.events){var i=$('.popup-basket-fast-buy-form input[name="fio"]').val(),a=$('.popup-basket-fast-buy-form input[name="phone"]').val(),o=$('.popup-basket-fast-buy-form input[name="email"]').val();""==i&&(i=window.digitalData.user.firstName),""==o&&(o=window.digitalData.user.email);var n={category:"Ecommerce",name:"Completed Transaction",transaction:{orderId:t.orderId,currency:window.digitalData.cart.currency,subtotal:t.DDL.subtotal,total:t.DDL.total,lineItems:t.DDL.lineItems,checkoutType:"1-step-cart",contactInfo:{name:i,phone:a,email:o},vouchers:[]}};void 0===window.digitalData.user.userId&&(n.user={firstName:i,email:o,phone:a}),window.digitalData.events.push(n);for(var r=[],l=0;l<window.digitalData.cart.lineItems.length;l++)r.push({id:window.digitalData.cart.lineItems[l].product.id,qnt:window.digitalData.cart.lineItems[l].quantity,price:window.digitalData.cart.lineItems[l].product.unitPrice});window.adspire_track=window.adspire_track||[],window.adspire_track.push({TypeOfPage:"confirm",Order:{id:t.adspire.orderId,type:"oneclick",totalprice:t.adspire.totalprice,usermail:"old",name:t.adspire.name,lastname:"",email:t.adspire.email,coupon:t.adspire.coupon},OrderItems:t.adspire.OrderItems})}}else{var d=s.find(".js-basket-fast-buy-error");s.find(".js-basket-fast-buy-content").hide(),d.find(".js-order-error").text(t.errors),d.show()}s.removeClass("load"),BX.closeWait()},error:function(t){s.removeClass("load"),BX.closeWait()}})},invalidHandler:function(t,e){BX.closeWait()}}),s.on("shown.bs.modal",function(){e.closeCart();var t=s.find(".popup-swiper-container");setTimeout(function(){$(window).trigger("resize"),t.css("visibility","visible")},300)}),$(window).width()>767&&l>2?d=!0:$(window).width()<=767&&l>1&&(d=!0),d&&(r.css("visibility","hidden"),r.slick({autoplay:!1,prevArrow:'<a class="i-slick__prev"></a>',nextArrow:'<a class="i-slick__next"></a>',responsive:[{breakpoint:2e3,settings:{slidesToShow:3,slidesToScroll:1}},{breakpoint:768,settings:{slidesToShow:2,slidesToScroll:1}}]})),t&&this.openCurrentCart(),$(window).width()<768&&o.on("swipe",function(t){e.closeCart()})}},openCurrentCart:function(){(this.isCurrentVisible?$("#"+this.cartId):$("#basketBlockClone")).find(".b-fast-cart").addClass("b-fast-cart_show")}};